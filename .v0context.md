# V0 Context - Salone Bellezza Prenotazioni

Questo file fornisce il contesto necessario a V0 per generare codice coerente con questo progetto.

## ğŸ—ï¸ Architettura del Progetto

### Stack Tecnologico
- **Framework**: Next.js 16 con App Router
- **Linguaggio**: TypeScript (strict mode)
- **Database**: Firebase Firestore (NoSQL)
- **Auth**: Firebase Authentication
- **Storage**: Firebase Storage (per immagini)
- **Styling**: Tailwind CSS v4
- **UI Library**: shadcn/ui (Radix UI)
- **Icons**: Lucide React
- **Date**: date-fns con locale italiano

### Struttura Directory

```
app/
  â”œâ”€â”€ actions/          # Server Actions (tutti "use server")
  â”œâ”€â”€ admin/           # Route admin (protette)
  â”œâ”€â”€ account/         # Area personale cliente (protetta)
  â”œâ”€â”€ book/            # Route prenotazione (protetta)
  â”œâ”€â”€ login/           # Login cliente
  â”œâ”€â”€ register/        # Registrazione cliente
  â””â”€â”€ page.tsx         # Homepage

components/
  â”œâ”€â”€ admin/           # Componenti admin dashboard
  â”œâ”€â”€ booking/         # Componenti wizard prenotazione
  â””â”€â”€ ui/              # Componenti shadcn/ui

lib/
  â”œâ”€â”€ firebase.ts      # Firebase Client SDK
  â”œâ”€â”€ firebase-admin.ts # Firebase Admin SDK
  â”œâ”€â”€ firestore-utils.ts # Utility timestamp
  â””â”€â”€ logger.ts        # Sistema logging

types/
  â””â”€â”€ index.ts         # Tutte le interfacce TypeScript
```

## ğŸ“‹ Pattern Principali

### Server Actions

Tutte le operazioni database sono Server Actions in `app/actions/`:

```typescript
"use server"

import { getAdminDb } from "@/lib/firebase-admin"
import { logger } from "@/lib/logger"
import type { Service } from "@/types"

export async function myAction(input: MyInput): Promise<MyResult> {
  const startTime = Date.now()
  try {
    const adminDb = getAdminDb()
    // ... operazioni
    logger.info("Action completed", { duration: Date.now() - startTime })
    return { success: true }
  } catch (error: any) {
    logger.error("Action failed", { error: error.message })
    return { success: false, error: "Error message" }
  }
}
```

### Client Components

Componenti interattivi devono essere `"use client"`:

```typescript
"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import type { Service } from "@/types"

export function MyComponent() {
  const [state, setState] = useState<Service | null>(null)
  // ...
}
```

### Authentication Guards

Proteggere route con guard components:

```typescript
// Per clienti
<CustomerAuthGuard>
  <MyProtectedComponent />
</CustomerAuthGuard>

// Per admin
<AdminAuthGuard>
  <AdminComponent />
</AdminAuthGuard>
```

### Firebase Usage

**Server Actions** (usa Admin SDK):
```typescript
import { getAdminDb } from "@/lib/firebase-admin"
const adminDb = getAdminDb()
const doc = await adminDb.collection("bookings").doc(id).get()
```

**Client Components** (usa Client SDK):
```typescript
import { db, auth, storage } from "@/lib/firebase"
import { collection, query, where, getDocs } from "firebase/firestore"
```

### Type Safety

Sempre usare i tipi da `@/types`:

```typescript
import type { Service, Booking, Customer, BookingStatus } from "@/types"
```

### Timestamp Serialization

Converti sempre i Timestamp Firestore:

```typescript
import { convertTimestamp } from "@/lib/firestore-utils"

const booking = {
  ...data,
  createdAt: convertTimestamp(data.createdAt),
  updatedAt: convertTimestamp(data.updatedAt),
}
```

### UI Components

Usa sempre componenti da `@/components/ui`:

```typescript
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Input } from "@/components/ui/input"
import { Badge } from "@/components/ui/badge"
```

### Date Formatting

Usa date-fns con locale italiano:

```typescript
import { format } from "date-fns"
import { it } from "date-fns/locale"

format(new Date(date), "EEEE d MMMM yyyy", { locale: it })
```

### Error Handling

Usa il logger per errori:

```typescript
import { logger } from "@/lib/logger"

try {
  // ...
} catch (error: any) {
  logger.error("Operation failed", { 
    error: error.message || error,
    context: { /* dati rilevanti */ }
  })
}
```

## ğŸ¨ Styling Patterns

### Tailwind Classes

```typescript
// Layout
className="flex items-center justify-between gap-4"

// Cards
className="border-2 shadow-xl rounded-lg p-6"

// Buttons
className="bg-primary text-primary-foreground hover:bg-primary/90"

// Responsive
className="grid gap-4 md:grid-cols-2 lg:grid-cols-3"
```

### Color Scheme

- Primary: Colore principale (configurato in globals.css)
- Muted: Colori secondari
- Destructive: Rosso per azioni pericolose
- Success: Verde per conferme

## ğŸ” Security Patterns

1. **Server Actions**: Sempre validare input
2. **Admin Operations**: Verificare ruolo admin
3. **Customer Operations**: Verificare ownership
4. **Firestore Rules**: Configurate in Firebase Console
5. **Storage Rules**: Configurate in storage.rules

## ğŸ“§ Email Patterns

Email inviate tramite Resend (opzionale):

```typescript
import { sendBookingConfirmationEmail } from "@/app/actions/email"

await sendBookingConfirmationEmail(booking, customer)
```

## ğŸš« Cose da NON Fare

1. âŒ Non importare `firebase-admin` in client components
2. âŒ Non passare Timestamp Firestore direttamente a client
3. âŒ Non usare `db` (client SDK) in Server Actions
4. âŒ Non committare file `.env*`
5. âŒ Non hardcodare valori (usare config)

## âœ… Best Practices

1. âœ… Usa sempre TypeScript types
2. âœ… Valida input in Server Actions
3. âœ… Usa logger per debugging
4. âœ… Gestisci errori gracefully
5. âœ… Usa componenti riutilizzabili
6. âœ… Segui naming conventions esistenti
7. âœ… Documenta codice complesso

## ğŸ“ Naming Conventions

- **Components**: PascalCase (`BookingWizard.tsx`)
- **Server Actions**: camelCase (`createBooking.ts`)
- **Types**: PascalCase (`Booking`, `Service`)
- **Files**: kebab-case per route (`admin-dashboard.tsx`)
- **Variables**: camelCase (`selectedService`)

## ğŸ¯ Esempi di Codice

### Nuovo Server Action

```typescript
"use server"

import { getAdminDb } from "@/lib/firebase-admin"
import { logger } from "@/lib/logger"
import type { Service } from "@/types"

export interface CreateServiceInput {
  name: string
  price: number
  // ...
}

export async function createService(
  input: CreateServiceInput
): Promise<{ success: boolean; error?: string }> {
  const startTime = Date.now()
  try {
    // Validazione
    if (!input.name) {
      return { success: false, error: "Nome richiesto" }
    }

    // Operazioni
    const adminDb = getAdminDb()
    const docRef = adminDb.collection("services").doc()
    await docRef.set({
      ...input,
      createdAt: new Date().toISOString(),
    })

    logger.info("Service created", { serviceId: docRef.id, duration: Date.now() - startTime })
    return { success: true }
  } catch (error: any) {
    logger.error("Error creating service", { error: error.message })
    return { success: false, error: "Errore durante la creazione" }
  }
}
```

### Nuovo Componente Client

```typescript
"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import type { Service } from "@/types"
import { createService } from "@/app/actions/services"

export function ServiceForm() {
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setLoading(true)
    setError(null)

    try {
      const result = await createService({
        name: "Example",
        price: 50,
      })

      if (result.success) {
        // Success
      } else {
        setError(result.error || "Errore")
      }
    } catch (err) {
      setError("Errore imprevisto")
    } finally {
      setLoading(false)
    }
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle>Nuovo Servizio</CardTitle>
      </CardHeader>
      <CardContent>
        <form onSubmit={handleSubmit}>
          {/* Form fields */}
          <Button type="submit" disabled={loading}>
            {loading ? "Caricamento..." : "Crea"}
          </Button>
        </form>
      </CardContent>
    </Card>
  )
}
```

---

**Usa questo file come riferimento quando V0 genera codice per questo progetto.**

